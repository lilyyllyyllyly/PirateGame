[gd_scene load_steps=50 format=3 uid="uid://d3hqdk77sg32n"]

[ext_resource type="Texture2D" uid="uid://wvt8keytohdj" path="res://Sprites/Player/Idle/player-idle1.png" id="2_3suvf"]
[ext_resource type="Texture2D" uid="uid://6eo8adbewj0x" path="res://Sprites/Player/Idle/player-idle2.png" id="3_4o6ir"]
[ext_resource type="Texture2D" uid="uid://b2m6l3w7lt6k" path="res://Sprites/Player/Idle/player-idle3.png" id="4_vqftp"]
[ext_resource type="PackedScene" uid="uid://cls58w461gqat" path="res://Scenes/Effects/BoostEffect.tscn" id="5_gmarb"]
[ext_resource type="Texture2D" uid="uid://nbe0a80vjqf6" path="res://Sprites/Player/Idle/player-idle4.png" id="5_vgjfj"]
[ext_resource type="Texture2D" uid="uid://oxr43coi3glm" path="res://Sprites/Player/Walk/player-walk1.png" id="6_p7tqd"]
[ext_resource type="Texture2D" uid="uid://dkec4k7ys1uiq" path="res://Sprites/Player/Walk/player-walk2.png" id="7_8w7j3"]
[ext_resource type="Texture2D" uid="uid://nasjxl3n1l2h" path="res://Sprites/Player/Walk/player-walk3.png" id="8_4npda"]
[ext_resource type="Texture2D" uid="uid://bjvbwl2qnnuo6" path="res://Sprites/Player/Walk/player-walk4.png" id="9_s8rm1"]
[ext_resource type="Texture2D" uid="uid://dh48tdvsabj86" path="res://Sprites/Player/Float/player-float1.png" id="10_01o7i"]
[ext_resource type="Texture2D" uid="uid://benl45jie3nd0" path="res://Sprites/Player/Float/player-float2.png" id="11_ku8ue"]
[ext_resource type="Texture2D" uid="uid://mab7xwspqtsr" path="res://Sprites/Player/Swim/player-swim1.png" id="12_cw6c7"]
[ext_resource type="Texture2D" uid="uid://jlgw6x165swn" path="res://Sprites/Player/Swim/player-swim2.png" id="13_cii4u"]
[ext_resource type="Texture2D" uid="uid://da3ptkmosjbb1" path="res://Sprites/Player/Swim/player-swim3.png" id="14_50lpy"]
[ext_resource type="Texture2D" uid="uid://c072kvgx3mt6x" path="res://Sprites/Player/Swim/player-swim4.png" id="15_e31pa"]
[ext_resource type="Texture2D" uid="uid://bjascss77v04" path="res://Sprites/Player/Boost/player-boost1.png" id="16_8pm2k"]
[ext_resource type="Texture2D" uid="uid://bw2xopc3lakfh" path="res://Sprites/Player/Boost/player-boost2.png" id="17_7j1ed"]
[ext_resource type="Texture2D" uid="uid://ft6hj6474r4y" path="res://Sprites/Player/Boost/player-boost3.png" id="18_fw0vu"]
[ext_resource type="Script" path="res://Scripts/Animation/PlayerAnimation.gd" id="18_idgqc"]
[ext_resource type="Script" path="res://Scripts/Behaviours/CharacterMover.gd" id="19_fnyit"]
[ext_resource type="Script" path="res://Scripts/Behaviours/WaterLeaveBoost.gd" id="19_gtfkb"]
[ext_resource type="Script" path="res://Scripts/Effects/WaterBoostParticle.gd" id="19_s4hwc"]
[ext_resource type="Script" path="res://Scripts/Behaviours/Gravity.gd" id="20_8hehk"]
[ext_resource type="Script" path="res://Scripts/Movement/Calculators/HorizontalMovement.gd" id="20_ddyps"]
[ext_resource type="Script" path="res://Scripts/Behaviours/CharacterVelocity.gd" id="20_nj0y8"]
[ext_resource type="Script" path="res://Scripts/Behaviours/States/StateMachine.gd" id="21_0f3q0"]
[ext_resource type="Script" path="res://Scripts/Input/Directions/PlayerHorizontalDirection.gd" id="21_hpk8n"]
[ext_resource type="Script" path="res://Scripts/Behaviours/States/StateSwitcher.gd" id="22_1mnb8"]
[ext_resource type="Script" path="res://Scripts/Behaviours/Jump.gd" id="22_vihjo"]
[ext_resource type="Script" path="res://Scripts/Behaviours/States/State.gd" id="23_lw60q"]
[ext_resource type="Script" path="res://Scripts/Input/Conditions/JumpHeldCondition.gd" id="23_r2dyy"]
[ext_resource type="Script" path="res://Scripts/Movement/Calculators/PlaneMovement.gd" id="28_ttw5v"]
[ext_resource type="Script" path="res://Scripts/Input/Directions/PlayerPlaneDirection.gd" id="29_8h0eh"]
[ext_resource type="Script" path="res://Scripts/Behaviours/Boost.gd" id="30_efbaw"]
[ext_resource type="Script" path="res://Scripts/Input/Signals/JumpPressSignal.gd" id="31_fxhgp"]
[ext_resource type="Script" path="res://Scripts/WaterChecker.gd" id="34_vlw6o"]
[ext_resource type="Script" path="res://Scripts/Thrower.gd" id="35_xf1i7"]
[ext_resource type="Script" path="res://Scripts/Input/Signals/CounterSignal.gd" id="36_wx7gs"]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_fxtra"]
radius = 4.0
height = 14.0

[sub_resource type="Animation" id="Animation_cpta1"]
resource_name = "RESET"
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("2_3suvf")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:offset")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0, -2)]
}

[sub_resource type="Animation" id="Animation_y3asb"]
resource_name = "player-boost"
length = 0.4
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 1,
"values": [ExtResource("16_8pm2k"), ExtResource("17_7j1ed"), ExtResource("18_fw0vu")]
}

[sub_resource type="Animation" id="Animation_fv0hq"]
resource_name = "player-float"
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.6),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [ExtResource("10_01o7i"), ExtResource("11_ku8ue")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:offset")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.6, 0.9),
"transitions": PackedFloat32Array(1, 0.3, 0.3),
"update": 0,
"values": [Vector2(0, -2), Vector2(0, 0), Vector2(0, -2)]
}

[sub_resource type="Animation" id="Animation_c5fua"]
resource_name = "player-idle"
length = 0.6
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [ExtResource("2_3suvf"), ExtResource("3_4o6ir"), ExtResource("4_vqftp"), ExtResource("5_vgjfj")]
}

[sub_resource type="Animation" id="Animation_ppxw5"]
resource_name = "player-jump"
length = 0.1
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("7_8w7j3")]
}

[sub_resource type="Animation" id="Animation_51grv"]
resource_name = "player-swim"
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.3, 0.4, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [ExtResource("12_cw6c7"), ExtResource("13_cii4u"), ExtResource("14_50lpy"), ExtResource("15_e31pa")]
}

[sub_resource type="Animation" id="Animation_naceo"]
resource_name = "player-walk"
length = 0.4
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [ExtResource("6_p7tqd"), ExtResource("7_8w7j3"), ExtResource("8_4npda"), ExtResource("9_s8rm1")]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_5elcj"]
_data = {
"RESET": SubResource("Animation_cpta1"),
"player-boost": SubResource("Animation_y3asb"),
"player-float": SubResource("Animation_fv0hq"),
"player-idle": SubResource("Animation_c5fua"),
"player-jump": SubResource("Animation_ppxw5"),
"player-swim": SubResource("Animation_51grv"),
"player-walk": SubResource("Animation_naceo")
}

[sub_resource type="RectangleShape2D" id="RectangleShape2D_8gxnn"]
size = Vector2(9, 9)

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_pjuib"]
radius = 3.0
height = 12.0

[node name="Player" type="CharacterBody2D"]
collision_mask = 8

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CapsuleShape2D_fxtra")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("2_3suvf")
offset = Vector2(0, -2)

[node name="AnimationPlayer" type="AnimationPlayer" parent="." node_paths=PackedStringArray("sprite", "body", "plane_direction", "horizontal_direction")]
libraries = {
"": SubResource("AnimationLibrary_5elcj")
}
script = ExtResource("18_idgqc")
sprite = NodePath("../Sprite2D")
body = NodePath("..")
plane_direction = NodePath("../States/WaterState/WaterMovement/PlaneMovement/Direction")
horizontal_direction = NodePath("../States/GroundState/GroundMovement/HorizontalMovement/Direction")
swim_stop_rot = 12.0
rot_offset_deg = 90.0

[node name="CharacterMover" type="Node" parent="." node_paths=PackedStringArray("body")]
script = ExtResource("19_fnyit")
body = NodePath("..")

[node name="WaterLeaveBoost" type="Node" parent="." node_paths=PackedStringArray("body", "water_move")]
script = ExtResource("19_gtfkb")
body = NodePath("..")
water_move = NodePath("../States/WaterState/WaterMovement/PlaneMovement")

[node name="States" type="Node" parent="." node_paths=PackedStringArray("state")]
script = ExtResource("21_0f3q0")
state = NodePath("GroundState")

[node name="StateEvents" type="Node" parent="States"]

[node name="LeaveWater" type="Node" parent="States/StateEvents" node_paths=PackedStringArray("state_machine", "new_state")]
script = ExtResource("22_1mnb8")
state_machine = NodePath("../..")
new_state = NodePath("../../GroundState")

[node name="EnterWater" type="Node" parent="States/StateEvents" node_paths=PackedStringArray("state_machine", "new_state")]
script = ExtResource("22_1mnb8")
state_machine = NodePath("../..")
new_state = NodePath("../../WaterState")

[node name="GroundState" type="Node" parent="States" node_paths=PackedStringArray("behaviours")]
script = ExtResource("23_lw60q")
behaviours = [NodePath("GroundMovement"), NodePath("Jump"), NodePath("Gravity")]
enabled = false

[node name="GroundMovement" type="Node" parent="States/GroundState" node_paths=PackedStringArray("body", "move")]
script = ExtResource("20_nj0y8")
body = NodePath("../../..")
move = NodePath("HorizontalMovement")
enabled = false

[node name="HorizontalMovement" type="Node" parent="States/GroundState/GroundMovement" node_paths=PackedStringArray("direction", "body")]
script = ExtResource("20_ddyps")
direction = NodePath("Direction")
body = NodePath("../../../..")
speed = 150.0
accel = 325.0

[node name="Direction" type="Node" parent="States/GroundState/GroundMovement/HorizontalMovement"]
script = ExtResource("21_hpk8n")

[node name="Jump" type="Node" parent="States/GroundState" node_paths=PackedStringArray("jump_held", "body")]
script = ExtResource("22_vihjo")
jump_held = NodePath("JumpHeld")
body = NodePath("../../..")
jump_force = -130.0
jump_hold = 200
enabled = false

[node name="JumpHeld" type="Node" parent="States/GroundState/Jump"]
script = ExtResource("23_r2dyy")

[node name="Gravity" type="Node" parent="States/GroundState" node_paths=PackedStringArray("body")]
script = ExtResource("20_8hehk")
body = NodePath("../../..")
enabled = false

[node name="WaterState" type="Node" parent="States" node_paths=PackedStringArray("behaviours")]
script = ExtResource("23_lw60q")
behaviours = [NodePath("WaterMovement"), NodePath("Boost")]
enabled = false

[node name="WaterMovement" type="Node" parent="States/WaterState" node_paths=PackedStringArray("body", "move")]
script = ExtResource("20_nj0y8")
body = NodePath("../../..")
move = NodePath("PlaneMovement")
enabled = false

[node name="PlaneMovement" type="Node" parent="States/WaterState/WaterMovement" node_paths=PackedStringArray("direction", "body")]
script = ExtResource("28_ttw5v")
direction = NodePath("Direction")
body = NodePath("../../../..")
speed = 150.0
accel = 325.0

[node name="Direction" type="Node" parent="States/WaterState/WaterMovement/PlaneMovement"]
script = ExtResource("29_8h0eh")

[node name="Boost" type="Node" parent="States/WaterState" node_paths=PackedStringArray("direction", "body")]
script = ExtResource("30_efbaw")
direction = NodePath("../WaterMovement/PlaneMovement/Direction")
body = NodePath("../../..")
boost_amount = 100.0
boost_delay = 300
enabled = false

[node name="JumpPressSignal" type="Node" parent="States/WaterState/Boost"]
script = ExtResource("31_fxhgp")

[node name="WaterChecker" type="Area2D" parent="."]
collision_layer = 4
collision_mask = 2
monitorable = false
script = ExtResource("34_vlw6o")

[node name="CollisionShape2D" type="CollisionShape2D" parent="WaterChecker"]
position = Vector2(-0.5, -2.5)
shape = SubResource("RectangleShape2D_8gxnn")

[node name="Effects" type="Node" parent="."]

[node name="WaterBoostParticle" type="Node" parent="Effects" node_paths=PackedStringArray("direction", "player")]
script = ExtResource("19_s4hwc")
direction = NodePath("../../States/WaterState/WaterMovement/PlaneMovement/Direction")
player = NodePath("../..")
boost_effect = ExtResource("5_gmarb")
rot_offset = 4.712

[node name="DamageChecker" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 32

[node name="CollisionShape2D" type="CollisionShape2D" parent="DamageChecker"]
position = Vector2(0, 1)
shape = SubResource("CapsuleShape2D_pjuib")

[node name="Thrower" type="Node" parent="." node_paths=PackedStringArray("body")]
script = ExtResource("35_xf1i7")
body = NodePath("..")
intensity = 125.0

[node name="CounterSignal" type="Node" parent="."]
script = ExtResource("36_wx7gs")
initial_value = 3
maxv = 3

[connection signal="should_boost" from="WaterLeaveBoost" to="States/WaterState/Boost" method="boost"]
[connection signal="boosted" from="States/WaterState/Boost" to="Effects/WaterBoostParticle" method="spawn_particle"]
[connection signal="jump_pressed" from="States/WaterState/Boost/JumpPressSignal" to="AnimationPlayer" method="on_jump_pressed"]
[connection signal="jump_pressed" from="States/WaterState/Boost/JumpPressSignal" to="States/WaterState/Boost" method="boost_delayed"]
[connection signal="area_entered" from="WaterChecker" to="AnimationPlayer" method="on_enter_water" unbinds=1]
[connection signal="area_entered" from="WaterChecker" to="States/StateEvents/EnterWater" method="switch" unbinds=1]
[connection signal="area_exited" from="WaterChecker" to="WaterChecker" method="on_area_exited" unbinds=1]
[connection signal="left_water" from="WaterChecker" to="AnimationPlayer" method="on_exit_water"]
[connection signal="left_water" from="WaterChecker" to="WaterLeaveBoost" method="on_water_exited"]
[connection signal="left_water" from="WaterChecker" to="States/StateEvents/LeaveWater" method="switch"]
[connection signal="area_entered" from="DamageChecker" to="Thrower" method="throw_away_from" binds= [false]]
[connection signal="area_entered" from="DamageChecker" to="CounterSignal" method="decrement" unbinds=1]
